<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Robot Dashboard</title>
<style>
:root{--bg:#071021;--card:#0f1724;--accent:#3b82f6;--muted:#94a3b8;--white:#e6eef8}
body{margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#031022 0%,#071026 100%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
.card{background:var(--card);padding:28px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);width:360px;text-align:center;color:var(--white);box-shadow:0 6px 30px rgba(2,6,23,0.7);position:relative}
h1{margin:0 0 8px;font-size:20px}
p{margin:0 0 12px;color:var(--muted);font-size:13px}
pre{background:#0b1324;padding:8px 12px;border-radius:6px;margin:4px 0;font-size:13px;overflow-x:auto;color:#e6eef8;}
input[type=text], input[type=number]{width:100%;padding:10px;margin:4px 0 10px;border-radius:8px;border:1px solid #253046;background:#071022;color:white;outline:none;font-size:14px}
button{width:100%;padding:12px 18px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:600;cursor:pointer;font-size:15px;margin-top:6px}
button.secondary{background:#334155}
button.instruction{background:#64748b;margin-top:4px;}
.small{font-size:12px;color:var(--muted);margin-top:12px}

/* Modal */
.modal-bg{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;z-index:10}
.modal{background:var(--card);padding:20px;border-radius:12px;width:90%;max-width:500px;color:white;position:relative;max-height:80vh;overflow-y:auto}
.modal h2{margin-top:0;font-size:18px;}
.modal button.close{position:absolute;top:10px;right:12px;background:#ef4444;padding:4px 8px;border:none;border-radius:6px;cursor:pointer;color:white;}
</style>
</head>
<body>

<div class="card">
  <h1>Robot Dashboard</h1>
  <p>Enter your ROSBridge IP and port to continue:</p>

  <div class="instructions" style="text-align:left;font-size:12px;color:#94a3b8;margin-bottom:6px">
    <strong>CLI commands for IP:</strong>
    <pre>Linux: hostname -I | awk '{print $1}'</pre>
    <pre>Windows: $ip = (Get-NetIPAddress -AddressFamily IPv4 | Where-Object { $_.InterfaceAlias -like "*Ethernet*" -or $_.InterfaceAlias -like "*Wi-Fi*" }).IPAddress
$ip[0]</pre>
  </div>

  <input id="hostInput" type="text" placeholder="Robot IP (e.g., 192.168.x.x)">
  <input id="portInput" type="number" value="9090" min="1" max="65535">

  <button onclick="openDashboard()">Web Control Dashboard</button>
  <button class="secondary" onclick="openTest()">Test WS Connection</button>
  <button class="instruction" onclick="showInstructions()">Instructions</button>

  <div class="small">Settings are saved for next session.</div>
</div>

<!-- Modal -->
<div id="modal" class="modal-bg">
  <div class="modal">
    <button class="close" onclick="closeInstructions()">X</button>
    <h2>Instructions</h2>
    <p>Welcome! Hereâ€™s how to use the web control dashboard:</p>
    <ul style="font-size:13px;line-height:1.4;color:#e2e8f0">
      <li>Make sure ROS2 is running on your robot and ROSBridge server is launched:
        <pre>ros2 launch rosbridge_server rosbridge_websocket_launch.xml</pre>
      </li>
      <li>Enter the IP of your robot and port 9090 (default) in the fields above.</li>
      <li>Click <strong>Web Control Dashboard</strong> to open the control interface.</li>
      <li>Use sliders or joysticks to move the robot joints.</li>
      <li>You can test the websocket connection using the <strong>Test WS Connection</strong> button before opening the dashboard.</li>
      <li>Settings are stored in your browser so you won't need to re-enter the IP next time.</li>
    </ul>
  </div>
</div>

<script>
function openDashboard(){
  const host = document.getElementById('hostInput').value.trim();
  const port = document.getElementById('portInput').value.trim() || '9090';
  if(!host){ alert('Enter a robot IP'); return; }
  localStorage.setItem('ros_host', host);
  localStorage.setItem('ros_port', port);
  window.location.href = 'web_control.html';
}

function openTest(){
  const host = document.getElementById('hostInput').value.trim();
  const port = document.getElementById('portInput').value.trim() || '9090';
  if(!host){ alert('Enter a robot IP'); return; }
  localStorage.setItem('ros_host', host);
  localStorage.setItem('ros_port', port);
  window.location.href = 'test.html';
}

function showInstructions(){
  document.getElementById('modal').style.display = 'flex';
}

function closeInstructions(){
  document.getElementById('modal').style.display = 'none';
}

// load saved values if any
window.addEventListener('load', ()=>{
  const host = localStorage.getItem('ros_host') || '';
  const port = localStorage.getItem('ros_port') || '9090';
  document.getElementById('hostInput').value = host;
  document.getElementById('portInput').value = port;
});
</script>

</body>
</html>
